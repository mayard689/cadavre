{% extends 'email.html.twig' %}

{% block title %}Des infos toutes chaudes du Comité des Fêtes de Villereau !{% endblock %}

{% block stylesheets %}{% endblock %}

{% block object %}{{newsletter.subject}}{% endblock %}

{% block message %}

    {% set texts = newsletter.text|split('\n') %}
    {%  for text in texts %}
        {% set text = text|trim %}
        {% set open = text[0:5] %}
        {% set close = text[-6:] %}

        {% if open == '[img]' and close == '[/img]' %}
            <p style="
                        text-align:center;
                    ">
                <img style="
                            max-width: 300px;
                            text-align:center;
                        " alt="{{ text[5:-6] }}"
                 src="{{ text[5:-6] }}">
            </p>

        {% elseif open == '[btn]' and close == '[/btn]'%}

            {% set address = text[5:-6] %}

            {% if address[0:8] != 'https://' %}
                {% set address = 'https://' ~ address %}
            {% endif %}

            {% if address[-5:] == '[tag]' %}
                {% set address = address[0:-5] %}

                {% if secret is defined %}
                    {% set address = address ~ secret[0:5] %}
                {% endif %}
            {% endif %}

            <p style="
                        text-align:center;
                    ">
                <a style="
                        font-size: 1.0rem;
                        color: #F0EFEA;
                        border-radius: 5px;
                        background-color: #622247;
                        border-color: #622247;
                        text-decoration: none;
                        padding: 0.25rem 0.5rem;
                    "
                   href="{{ address }}">
                    c'est ici ;-)
                </a>
            </p>

        {% else %}
            <p>{{ text }}</p>

        {% endif %}

    {%  endfor %}

{% endblock %}

{% block footer %}
    {% if (test is defined) and test %}
        <p>Appuyez sur le bouton ci dessous si cet email vous convient et que vous autorisez sa diffusion.</p>
        <a style="
                    font-size: 1.0rem;
                    color: #F0EFEA;
                    border-radius: 5px;
                    background-color: #622247;
                    border-color: #622247;
                    text-decoration: none;
                    padding: 0.25rem 0.5rem;
                "
           href="{{ app.request.schemeAndHttpHost }}{{ path('newsletter_unlock', {'versionning' : newsletter.versionning}) }}">
            Autoriser la diffusion de cet email
        </a>
    {% endif %}
{% endblock %}
